<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

  <title>OpenStack Docs: Certificates for PKI</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<!-- CSS references are in the css.html template -->
    <!-- Bootstrap Core CSS -->
    <link href="_static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Pygments css -->
    <link href="_static/css/native.css" rel="stylesheet">

    <!-- Fonts -->
    <!--<link href="font-awesome.min.css" rel="stylesheet">-->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

	<!-- BB: theme style sheets moved here so that theme rules aren't 
	     overridden by awesome rules. Should they go after the scripts below? -->
    <!-- Custom CSS -->
    <link href="_static/css/combined.css" rel="stylesheet">
    <link href="_static/css/styles.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Page-specific CSS -->
  
  
 </head>
 <body>
    <!-- Header -->
        <!-- Header Navigation -->
        <nav class="navbar navbar-default inner" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
             <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
      <span class="sr-only">
      Toggle navigation
      </span>
      <span class="icon-bar">
      </span>
      <span class="icon-bar">
      </span>
      <span class="icon-bar">
      </span>
      </button>
                <div class="brand-wrapper">
                    <a class="navbar-brand" href="/"></a>
                </div>
                <div class="search-icon show"><i class="fa fa-search"></i>
Search</div>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling
-->
            <div class="collapse navbar-collapse"
id="bs-example-navbar-collapse-1">
                <div class="search-container tiny">



  <div id="gcse">
    <script type="text/javascript">
      (function() {
        var cx = '000108871792296872333:noj9nikm74i';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' :
'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:search gname="standard"></gcse:search>
  </div>


                    <i class="fa fa-times close-search"></i>
                </div>
                    <ul class="nav navbar-nav navbar-main show">
                        <li>



  <div id="gcse-mobile">
    <gcse:search gname="mobile"></gcse:search>
  </div>


                        </li>


                        <li>

                                <a href="http://www.openstack.org/software/" class="drop"
id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuSoftware">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-compute/">Compute</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-storage/">Storage</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-networking/">Networking</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-dashboard/">Dashboard</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-shared-services/">Shared Services</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get
Started</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/user-stories/" class="drop"
id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuUsers">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//superuser.openstack.org/">Superuser
Magazine</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/enterprise/auto/">Featured:  Top 10
Automaker</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/community/" class="drop"
id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuCommunity">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//ask.openstack.org/">Ask A Technical
Question</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//wiki.openstack.org/wiki/Main_Page">OpenStack Wiki</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/events/">Community Events</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//wiki.openstack.org/wiki/Getting_The_Code">Source Code</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/foundation/companies/">Supporting Companies</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/jobs/">Jobs</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//www.openstack.org/join/">Join The
Community</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/marketplace/">Marketplace</a>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/events/" class="drop"
id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuEvents">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/events/">Overview</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/summit/openstack-paris-summit-2014/">The OpenStack
Summit</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More
OpenStack Events</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/blog/">Blog</a>

                        </li>

                        <li>

                                <a href="http://docs.openstack.org/">Docs</a>

                        </li>


                        <li>
                            <a href="http://openstack.org/Security/login/"
class="sign-in-btn">Sign In</a>
                        </li>
                    </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Begin Page Content -->
        <div class="container docs-book-wrapper">
        <div class="row">
            <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<!-- Row with title and buttons-->
            <div class="row">
                <div class="col-lg-8">
                <h2>Certificates for PKI</h2>
                </div>
<div class="docs-actions">
                  
                  <a href="identity_concepts.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Identity concepts"></i></a>
                  
                  
                  <a href="keystone_configure_with_SSL.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Configure the Identity service with SSL"></i></a>
                  
                  <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
                </div>
            </div>
            <div class="row docs-byline">
                <div class="docs-updated">
                    updated: 2015-10-23 15:47 | release: 0.9
                </div>
                <a href="http://git.openstack.org/" class="docs-edit">
                    <i class="fa fa-pencil"></i> suggest edits
                </a>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="docs-top-contents">
                    <h5>Contents</h5>
                    <ul>
<li><a class="reference internal" href="#">Certificates for PKI</a><ul>
<li><a class="reference internal" href="#sign-certificate-issued-by-external-ca">Sign certificate issued by external CA</a></li>
<li><a class="reference internal" href="#request-a-signing-certificate-from-an-external-ca">Request a signing certificate from an external CA</a></li>
<li><a class="reference internal" href="#install-an-external-signing-certificate">Install an external signing certificate</a></li>
<li><a class="reference internal" href="#switching-out-expired-signing-certificates">Switching out expired signing certificates</a></li>
</ul>
</li>
</ul>

                    </div>
                <div class="docs-body">

  <div class="section" id="certificates-for-pki">
<h1>Certificates for PKI<a class="headerlink" href="#certificates-for-pki" title="Permalink to this headline">¶</a></h1>
<p>PKI stands for Public Key Infrastructure. Tokens are documents,
cryptographically signed using the X509 standard. In order to work
correctly token generation requires a public/private key pair. The
public key must be signed in an X509 certificate, and the certificate
used to sign it must be available as a Certificate Authority (CA)
certificate. These files can be generated either using the
<tt class="docutils literal"><span class="pre">keystone-manage</span></tt> utility, or externally generated. The files need to
be in the locations specified by the top level Identity service
configuration file <tt class="file docutils literal"><span class="pre">keystone.conf</span></tt> as specified in the above section.
Additionally, the private key should only be readable by the system user
that will run the Identity service.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The certificates can be world readable, but the private key cannot
be. The private key should only be readable by the account that is
going to sign tokens. When generating files with the
<strong class="command">keystone-manage pki_setup</strong> command, your best option is to run
as the pki user. If you run <strong class="command">keystone-manage</strong> as root, you can
append <em class="xref std std-option">--keystone-user</em> and <em class="xref std std-option">--keystone-group</em> parameters
to set the user name and group keystone is going to run under.</p>
</div>
<p>The values that specify where to read the certificates are under the
<tt class="docutils literal"><span class="pre">[signing]</span></tt> section of the configuration file. The configuration
values are:</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">certfile</span></tt></dt>
<dd><p class="first last">Location of certificate used to verify tokens. Default is
<tt class="file docutils literal"><span class="pre">/etc/keystone/ssl/certs/signing_cert.pem</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">keyfile</span></tt></dt>
<dd><p class="first last">Location of private key used to sign tokens. Default is
<tt class="file docutils literal"><span class="pre">/etc/keystone/ssl/private/signing_key.pem</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">ca_certs</span></tt></dt>
<dd><p class="first last">Location of certificate for the authority that issued
the above certificate. Default is
<tt class="file docutils literal"><span class="pre">/etc/keystone/ssl/certs/ca.pem</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">ca_key</span></tt></dt>
<dd><p class="first last">Location of the private key used by the CA. Default is
<tt class="file docutils literal"><span class="pre">/etc/keystone/ssl/private/cakey.pem</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">key_size</span></tt></dt>
<dd><p class="first last">Default is <tt class="docutils literal"><span class="pre">2048</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">valid_days</span></tt></dt>
<dd><p class="first last">Default is <tt class="docutils literal"><span class="pre">3650</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">cert_subject</span></tt></dt>
<dd><p class="first last">Certificate subject (auto generated certificate) for token signing.
Default is <tt class="docutils literal"><span class="pre">/C=US/ST=Unset/L=Unset/O=Unset/CN=www.example.com</span></tt>.</p>
</dd>
</dl>
</li>
</ul>
<p>When generating certificates with the <strong class="command">keystone-manage pki_setup</strong>
command, the <tt class="docutils literal"><span class="pre">ca_key</span></tt>, <tt class="docutils literal"><span class="pre">key_size</span></tt>, and <tt class="docutils literal"><span class="pre">valid_days</span></tt> configuration
options are used.</p>
<p>If the <strong class="command">keystone-manage pki_setup</strong> command is not used to generate
certificates, or you are providing your own certificates, these values
do not need to be set.</p>
<p>If <tt class="docutils literal"><span class="pre">provider=keystone.token.providers.uuid.Provider</span></tt> in the
<tt class="docutils literal"><span class="pre">[token]</span></tt> section of the keystone configuration, a typical token looks
like <tt class="docutils literal"><span class="pre">53f7f6ef0cc344b5be706bcc8b1479e1</span></tt>. If
<tt class="docutils literal"><span class="pre">provider=keystone.token.providers.pki.Provider</span></tt>, a typical token is a
much longer string, such as:</p>
<div class="highlight-python"><div class="highlight"><pre>MIIKtgYJKoZIhvcNAQcCoIIKpzCCCqMCAQExCTAHBgUrDgMCGjCCCY8GCSqGSIb3DQEHAaCCCYAEggl8eyJhY2Nlc3MiOiB7InRva2VuIjogeyJpc3N1ZWRfYXQiOiAiMjAxMy0wNS0z
MFQxNTo1MjowNi43MzMxOTgiLCAiZXhwaXJlcyI6ICIyMDEzLTA1LTMxVDE1OjUyOjA2WiIsICJpZCI6ICJwbGFjZWhvbGRlciIsICJ0ZW5hbnQiOiB7ImRlc2NyaXB0aW9uIjogbnVs
bCwgImVuYWJsZWQiOiB0cnVlLCAiaWQiOiAiYzJjNTliNGQzZDI4NGQ4ZmEwOWYxNjljYjE4MDBlMDYiLCAibmFtZSI6ICJkZW1vIn19LCAic2VydmljZUNhdGFsb2ciOiBbeyJlbmRw
b2ludHMiOiBbeyJhZG1pblVSTCI6ICJodHRwOi8vMTkyLjE2OC4yNy4xMDA6ODc3NC92Mi9jMmM1OWI0ZDNkMjg0ZDhmYTA5ZjE2OWNiMTgwMGUwNiIsICJyZWdpb24iOiAiUmVnaW9u
T25lIiwgImludGVybmFsVVJMIjogImh0dHA6Ly8xOTIuMTY4LjI3LjEwMDo4Nzc0L3YyL2MyYzU5YjRkM2QyODRkOGZhMDlmMTY5Y2IxODAwZTA2IiwgImlkIjogIjFmYjMzYmM5M2Y5
ODRhNGNhZTk3MmViNzcwOTgzZTJlIiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTkyLjE2OC4yNy4xMDA6ODc3NC92Mi9jMmM1OWI0ZDNkMjg0ZDhmYTA5ZjE2OWNiMTgwMGUwNiJ9XSwg
ImVuZHBvaW50c19saW5rcyI6IFtdLCAidHlwZSI6ICJjb21wdXRlIiwgIm5hbWUiOiAibm92YSJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xOTIuMTY4LjI3
LjEwMDozMzMzIiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE5Mi4xNjguMjcuMTAwOjMzMzMiLCAiaWQiOiAiN2JjMThjYzk1NWFiNDNkYjhm
MGU2YWNlNDU4NjZmMzAiLCAicHVibGljVVJMIjogImh0dHA6Ly8xOTIuMTY4LjI3LjEwMDozMzMzIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBlIjogInMzIiwgIm5hbWUi
OiAiczMifSwgeyJlbmRwb2ludHMiOiBbeyJhZG1pblVSTCI6ICJodHRwOi8vMTkyLjE2OC4yNy4xMDA6OTI5MiIsICJyZWdpb24iOiAiUmVnaW9uT25lIiwgImludGVybmFsVVJMIjog
Imh0dHA6Ly8xOTIuMTY4LjI3LjEwMDo5MjkyIiwgImlkIjogIjczODQzNTJhNTQ0MjQ1NzVhM2NkOTVkN2E0YzNjZGY1IiwgInB1YmxpY1VSTCI6ICJodHRwOi8vMTkyLjE2OC4yNy4x
MDA6OTI5MiJ9XSwgImVuZHBvaW50c19saW5rcyI6IFtdLCAidHlwZSI6ICJpbWFnZSIsICJuYW1lIjogImdsYW5jZSJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6
Ly8xOTIuMTY4LjI3LjEwMDo4Nzc2L3YxL2MyYzU5YjRkM2QyODRkOGZhMDlmMTY5Y2IxODAwZTA2IiwgInJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDov
LzE5Mi4xNjguMjcuMTAwOjg3NzYvdjEvYzJjNTliNGQzZDI4NGQ4ZmEwOWYxNjljYjE4MDBlMDYiLCAiaWQiOiAiMzQ3ZWQ2ZThjMjkxNGU1MGFlMmJiNjA2YWQxNDdjNTQiLCAicHVi
bGljVVJMIjogImh0dHA6Ly8xOTIuMTY4LjI3LjEwMDo4Nzc2L3YxL2MyYzU5YjRkM2QyODRkOGZhMDlmMTY5Y2IxODAwZTA2In1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0eXBl
IjogInZvbHVtZSIsICJuYW1lIjogImNpbmRlciJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xOTIuMTY4LjI3LjEwMDo4NzczL3NlcnZpY2VzL0FkbWluIiwg
InJlZ2lvbiI6ICJSZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE5Mi4xNjguMjcuMTAwOjg3NzMvc2VydmljZXMvQ2xvdWQiLCAiaWQiOiAiMmIwZGMyYjNlY2U4NGJj
YWE1NDAzMDMzNzI5YzY3MjIiLCAicHVibGljVVJMIjogImh0dHA6Ly8xOTIuMTY4LjI3LjEwMDo4NzczL3NlcnZpY2VzL0Nsb3VkIn1dLCAiZW5kcG9pbnRzX2xpbmtzIjogW10sICJ0
eXBlIjogImVjMiIsICJuYW1lIjogImVjMiJ9LCB7ImVuZHBvaW50cyI6IFt7ImFkbWluVVJMIjogImh0dHA6Ly8xOTIuMTY4LjI3LjEwMDozNTM1Ny92Mi4wIiwgInJlZ2lvbiI6ICJS
ZWdpb25PbmUiLCAiaW50ZXJuYWxVUkwiOiAiaHR0cDovLzE5Mi4xNjguMjcuMTAwOjUwMDAvdjIuMCIsICJpZCI6ICJiNTY2Y2JlZjA2NjQ0ZmY2OWMyOTMxNzY2Yjc5MTIyOSIsICJw
dWJsaWNVUkwiOiAiaHR0cDovLzE5Mi4xNjguMjcuMTAwOjUwMDAvdjIuMCJ9XSwgImVuZHBvaW50c19saW5rcyI6IFtdLCAidHlwZSI6ICJpZGVudGl0eSIsICJuYW1lIjogImtleXN0
b25lIn1dLCAidXNlciI6IHsidXNlcm5hbWUiOiAiZGVtbyIsICJyb2xlc19saW5rcyI6IFtdLCAiaWQiOiAiZTVhMTM3NGE4YTRmNDI4NWIzYWQ3MzQ1MWU2MDY4YjEiLCAicm9sZXMi
OiBbeyJuYW1lIjogImFub3RoZXJyb2xlIn0sIHsibmFtZSI6ICJNZW1iZXIifV0sICJuYW1lIjogImRlbW8ifSwgIm1ldGFkYXRhIjogeyJpc19hZG1pbiI6IDAsICJyb2xlcyI6IFsi
YWRiODM3NDVkYzQzNGJhMzk5ODllNjBjOTIzYWZhMjgiLCAiMzM2ZTFiNjE1N2Y3NGFmZGJhNWUwYTYwMWUwNjM5MmYiXX19fTGB-zCB-AIBATBcMFcxCzAJBgNVBAYTAlVTMQ4wDAYD
VQQIEwVVbnNldDEOMAwGA1UEBxMFVW5zZXQxDjAMBgNVBAoTBVVuc2V0MRgwFgYDVQQDEw93d3cuZXhhbXBsZS5jb20CAQEwBwYFKw4DAhowDQYJKoZIhvcNAQEBBQAEgYCAHLpsEs2R
nouriuiCgFayIqCssK3SVdhOMINiuJtqv0sE-wBDFiEj-Prcudqlz-n+6q7VgV4mwMPszz39-rwp+P5l4AjrJasUm7FrO-4l02tPLaaZXU1gBQ1jUG5e5aL5jPDP08HbCWuX6wr-QQQB
SrWY8lF3HrTcJT23sZIleg==
</pre></div>
</div>
<div class="section" id="sign-certificate-issued-by-external-ca">
<h2>Sign certificate issued by external CA<a class="headerlink" href="#sign-certificate-issued-by-external-ca" title="Permalink to this headline">¶</a></h2>
<p>You can use a signing certificate issued by an external CA instead of
generated by <tt class="docutils literal"><span class="pre">keystone-manage</span></tt>. However, a certificate issued by an
external CA must satisfy the following conditions:</p>
<ul class="simple">
<li>All certificate and key files must be in Privacy Enhanced Mail (PEM)
format</li>
<li>Private key files must not be protected by a password</li>
</ul>
<p>When using a signing certificate issued by an external CA, you do not
need to specify <tt class="docutils literal"><span class="pre">key_size</span></tt>, <tt class="docutils literal"><span class="pre">valid_days</span></tt>, and <tt class="docutils literal"><span class="pre">ca_password</span></tt> as
they will be ignored.</p>
<p>The basic workflow for using a signing certificate issued by an external
CA involves:</p>
<ol class="arabic simple">
<li>Request Signing Certificate from External CA</li>
<li>Convert certificate and private key to PEM if needed</li>
<li>Install External Signing Certificate</li>
</ol>
</div>
<div class="section" id="request-a-signing-certificate-from-an-external-ca">
<h2>Request a signing certificate from an external CA<a class="headerlink" href="#request-a-signing-certificate-from-an-external-ca" title="Permalink to this headline">¶</a></h2>
<p>One way to request a signing certificate from an external CA is to first
generate a PKCS #10 Certificate Request Syntax (CRS) using OpenSSL CLI.</p>
<p>Create a certificate request configuration file. For example, create the
<tt class="file docutils literal"><span class="pre">cert_req.conf</span></tt> file, as follows:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[ req ]</span>
<span class="na">default_bits</span>            <span class="o">=</span> <span class="s">4096</span>
<span class="na">default_keyfile</span>         <span class="o">=</span> <span class="s">keystonekey.pem</span>
<span class="na">default_md</span>              <span class="o">=</span> <span class="s">sha256</span>

<span class="na">prompt</span>                  <span class="o">=</span> <span class="s">no</span>
<span class="na">distinguished_name</span>      <span class="o">=</span> <span class="s">distinguished_name</span>

<span class="k">[ distinguished_name ]</span>
<span class="na">countryName</span>             <span class="o">=</span> <span class="s">US</span>
<span class="na">stateOrProvinceName</span>     <span class="o">=</span> <span class="s">CA</span>
<span class="na">localityName</span>            <span class="o">=</span> <span class="s">Sunnyvale</span>
<span class="na">organizationName</span>        <span class="o">=</span> <span class="s">OpenStack</span>
<span class="na">organizationalUnitName</span>  <span class="o">=</span> <span class="s">Keystone</span>
<span class="na">commonName</span>              <span class="o">=</span> <span class="s">Keystone Signing</span>
<span class="na">emailAddress</span>            <span class="o">=</span> <span class="s">keystone@openstack.org</span>
</pre></div>
</div>
<p>Then generate a CRS with OpenSSL CLI. <strong>Do not encrypt the generated
private key. You must use the -nodes option.</strong></p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$ openssl req -newkey rsa:1024 -keyout signing_key.pem -keyform PEM \
  -out signing_cert_req.pem -outform PEM -config cert_req.conf -nodes
</pre></div>
</div>
<p>If everything is successful, you should end up with
<tt class="file docutils literal"><span class="pre">signing_cert_req.pem</span></tt> and <tt class="file docutils literal"><span class="pre">signing_key.pem</span></tt>. Send
<tt class="file docutils literal"><span class="pre">signing_cert_req.pem</span></tt> to your CA to request a token signing certificate
and make sure to ask the certificate to be in PEM format. Also, make sure your
trusted CA certificate chain is also in PEM format.</p>
</div>
<div class="section" id="install-an-external-signing-certificate">
<h2>Install an external signing certificate<a class="headerlink" href="#install-an-external-signing-certificate" title="Permalink to this headline">¶</a></h2>
<p>Assuming you have the following already:</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="file docutils literal"><span class="pre">signing_cert.pem</span></tt></dt>
<dd><p class="first last">(Keystone token) signing certificate in PEM format</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="file docutils literal"><span class="pre">signing_key.pem</span></tt></dt>
<dd><p class="first last">Corresponding (non-encrypted) private key in PEM format</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="file docutils literal"><span class="pre">cacert.pem</span></tt></dt>
<dd><p class="first last">Trust CA certificate chain in PEM format</p>
</dd>
</dl>
</li>
</ul>
<p>Copy the above to your certificate directory. For example:</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="c"># mkdir -p /etc/keystone/ssl/certs</span>
<span class="c"># cp signing_cert.pem /etc/keystone/ssl/certs/</span>
<span class="c"># cp signing_key.pem /etc/keystone/ssl/certs/</span>
<span class="c"># cp cacert.pem /etc/keystone/ssl/certs/</span>
<span class="c"># chmod -R 700 /etc/keystone/ssl/certs</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Make sure the certificate directory is only accessible by root.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The procedure of copying the key and cert files may be improved if
done after first running <strong class="command">keystone-manage pki_setup</strong> since this
command also creates other needed files, such as the <tt class="file docutils literal"><span class="pre">index.txt</span></tt>
and <tt class="file docutils literal"><span class="pre">serial</span></tt> files.</p>
<p class="last">Also, when copying the necessary files to a different server for
replicating the functionality, the entire directory of files is
needed, not just the key and cert files.</p>
</div>
<p>If your certificate directory path is different from the default
<tt class="file docutils literal"><span class="pre">/etc/keystone/ssl/certs</span></tt>, make sure it is reflected in the
<tt class="docutils literal"><span class="pre">[signing]</span></tt> section of the configuration file.</p>
</div>
<div class="section" id="switching-out-expired-signing-certificates">
<h2>Switching out expired signing certificates<a class="headerlink" href="#switching-out-expired-signing-certificates" title="Permalink to this headline">¶</a></h2>
<p>The following procedure details how to switch out expired signing
certificates with no cloud outages.</p>
<ol class="arabic simple">
<li>Generate a new signing key.</li>
<li>Generate a new certificate request.</li>
<li>Sign the new certificate with the existing CA to generate a new
<tt class="docutils literal"><span class="pre">signing_cert</span></tt>.</li>
<li>Append the new <tt class="docutils literal"><span class="pre">signing_cert</span></tt> to the old <tt class="docutils literal"><span class="pre">signing_cert</span></tt>. Ensure the
old certificate is in the file first.</li>
<li>Remove all signing certificates from all your hosts to force OpenStack
Compute to download the new <tt class="docutils literal"><span class="pre">signing_cert</span></tt>.</li>
<li>Replace the old signing key with the new signing key. Move the new
signing certificate above the old certificate in the <tt class="docutils literal"><span class="pre">signing_cert</span></tt>
file.</li>
<li>After the old certificate reads as expired, you can safely remove the
old signing certificate from the file.</li>
</ol>
</div>
</div>


              </div>
          </div>
          </div>
          <!-- <div class="docs-tags">
                <a href="#" class="docs-tag">Network Time Protocol (NTP)</a>
                <a href="#" class="docs-tag">Security</a>
                <a href="#" class="docs-tag">Conceptual architecture</a>
            </div> -->
<div class="docs-actions">
                  
                  <a href="identity_concepts.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Identity concepts"></i></a>
                  
                  
                  <a href="keystone_configure_with_SSL.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Configure the Identity service with SSL"></i></a>
                  
                  <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
                </div>
                <div class="row docs-byline bottom">
                <div class="docs-updated">
                updated: 2015-10-23 15:47 | release: 0.9
                </div>
                <a href="http://git.openstack.org/" class="docs-edit">
                    <i class="fa fa-pencil"></i> suggest edits
                </a>
</div>
    <div class="row">
         <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
           <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
<p>
 Except where otherwise noted, this document is licensed under Creative Commons
 Attribution 3.0 License
 <a href="#">http://creativecommons.org/licenses/by/3.0/legalcode</a>.
</p>
<p>
 <a href="http://www.openstack.org/legal">See All Legal Notices</a>
</p>
         </div>
         <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
                    <!-- ID buglinkbottom added so that pre-filled doc bugs
                    are sent to Launchpad projects related to the document -->
                    <a href="#" id="logABugLink2" class="docs-footer-actions">
                        <i class="fa fa-bug"></i>found an error? report a bug
                    </a>
                    <a href="http://ask.openstack.org" class="docs-footer-actions">
                        <i class="fa fa-question-circle"></i>questions? <a href="http://ask.openstack.org/">ask.openstack.org</a>
                    </a>
                </div>
     </div>
     </div>
            <!-- Docs Sidebar -->
                <div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
            <div class="search-icon show"><i class="fa fa-search"></i>
Search</div>
            <div class="btn-group docs-sidebar-releases">
                <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
                <button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">Release: Kilo (April 2015)<i class="fa fa-caret-down"></i></button>
                <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
                    <li role="presentation" class="dropdown-header">Releases</li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/kilo/">Kilo (current release)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/juno/">Juno (October 2014)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/icehouse/">Icehouse (May 2014)</a></li>
                    <li role="presentation" class="dropdown-header">Languages</li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/ja/">日本語 (Japanese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/de/">Deutsch (German)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/fr/">Français (French)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/pt_BR/">Português (Portuguese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/zh_CN/">简体中文 (Simplified Chinese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/ko_KR/">한국어 (Korean)</a></li>
                </ul>
            </div>
                <div class="docs-sidebar-toc">
                    <div class="docs-sidebar-section" id="install-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#install-guides"><h4>Install Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="user-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#user-guides"><h4>User Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="configuration-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#configuration-guides"><h4>Configuration Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="operations-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/openstack-ops/content/"><h4>Operations Guide</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="api-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#api-guides"><h4>API Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="contributor-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#contributor-guides"><h4>Contributor Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="table-of-contents">
                        <a class="docs-sidebar-section-title"><h4>Contents</h4></a>
                        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/get_started_with_openstack.html">Get started with OpenStack</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="identity_management.html">Identity management</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="identity_concepts.html">Identity concepts</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Certificates for PKI</a></li>
<li class="toctree-l2"><a class="reference internal" href="keystone_configure_with_SSL.html">Configure the Identity service with SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="keystone_external_authentication.html">External authentication with Identity</a></li>
<li class="toctree-l2"><a class="reference internal" href="keystone_integrate_with_ldap.html">Integrate Identity with LDAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="keystone_token-binding.html">Configure Identity service for token binding</a></li>
<li class="toctree-l2"><a class="reference internal" href="keystone_use_trusts.html">Use trusts</a></li>
<li class="toctree-l2"><a class="reference internal" href="keystone_caching_layer.html">Caching layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_user_crud.html">User CRUD</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_start.html">Start the Identity services</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_example_usage.html">Example usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_auth_token_middleware.html">Authentication middleware with user name and password</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_service_api_protection.html">Identity API protection with role-based access control (RBAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="identity_troubleshoot.html">Troubleshoot the Identity service</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute.html">Compute</a></li>
<li class="toctree-l1"><a class="reference internal" href="objectstorage.html">Object Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="blockstorage.html">Block Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="shared_file_systems.html">Shared File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="telemetry.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="baremetal.html">Bare Metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html">Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_project.html">Cross-project features</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/app_support.html">Community support</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

                    </div>
                </div>
                </div>

</div>
</div>
    <!-- End Page Content -->

    <!-- Footer -->
    <!-- Footer -->
        <footer>
        <div class="container">
            <div class="row footer-links">
                <div class="col-lg-2 col-sm-2">
                    <h3>OpenStack</h3>
                    <ul>
                        <li><a href="/foundation">About the Foundation</a></li>
                        <li><a
href="http://openstack.org/projects/">Projects</a></li>
                        <li><a
href="http://openstack.org/projects/openstack-security/">OpenStack
Security</a></li>
                        <li><a
href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
                        <li><a href="http://openstack.org/blog/">Blog</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Community</h3>
                    <ul>
                        <li><a href="http://openstack.org/community/">User
Groups</a></li>
                        <li><a
href="http://openstack.org/community/events/">Events</a></li>
                        <li><a
href="http://openstack.org/community/jobs/">Jobs</a></li>
                        <li><a
href="http://openstack.org/foundation/companies/">Companies</a></li>
                        <li><a
href="https://wiki.openstack.org/wiki/How_To_Contribute">Contribute</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Documentation</h3>
                    <ul>
                        <li><a href="http://docs.openstack.org">OpenStack
Manuals</a></li>
                        <li><a
href="http://openstack.org/software/start/">Getting Started</a></li>
                        <li><a href="http://developer.openstack.org">API
Documentation</a></li>
                        <li><a href="https://wiki.openstack.org">Wiki</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Branding & Legal</h3>
                    <ul>
                        <li><a href="http://openstack.org/brand/">Logos &
Guidelines</a></li>
                        <li><a
href="http://openstack.org/brand/openstack-trademark-policy/">Trademark
Policy</a></li>
                        <li><a href="http://openstack.org/privacy/">Privacy
Policy</a></li>
                        <li><a
href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributors_License_Agreement">OpenStack
CLA</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-sm-4">
                    <h3>Stay In Touch</h3>
                    <a href="https://twitter.com/OpenStack" target="_blank"
class="social-icons footer-twitter"></a>
                    <a href="https://www.facebook.com/openstack"
target="_blank" class="social-icons footer-facebook"></a>
                    <a href="https://www.linkedin.com/company/openstack"
target="_blank" class="social-icons footer-linkedin"></a>
                    <a href="https://www.youtube.com/user/OpenStackFoundation"
target="_blank" class="social-icons footer-youtube"></a>
                    <!-- <form class="form-inline">
                        <div class="form-group newsletter-form">
                            <label>Join Our Newsletter</label>
                            <input class="newsletter-input" type="input"
placeholder="Email">
                            <button type="submit"
class="newsletter-btn">Join</button>
                        </div>
                    </form> -->
                    <p class="fine-print">
                        The OpenStack project is provided under the Apache 2.0
license. Openstack.org is powered by <a href="http://rackspace.com"
target="_blank">Rackspace Cloud Computing</a>.
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <div class="footer-bottom">
        <div class="container">
            <form class="form-inline" id="FeedbackForm_FeedbackForm" action="/home/FeedbackForm" method="post" enctype="application/x-www-form-urlencoded">
              <div class="form-group">
                <div>
                  <input class="feedback-input" type="input" placeholder="Give Us Your Feedback On This Page">
                  <button type="submit" class="feedback-btn">Submit</button>
                </div>
              </div>
            </form>
        </div>
    </div>

<!-- Scripts in: static directory-->
    <!-- jQuery Version 1.11.0 -->
    <script type="text/javascript" src="_static/js/jquery-1.11.3.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

    <!-- The rest of the JS -->
    <script type="text/javascript" src="_static/js/navigation.js"></script>

    <!-- Docs JS -->
    <script type="text/javascript" src="_static/js/docs.js"></script>

    <!-- Popovers -->
    <script type="text/javascript" src="_static/js/webui-popover.js"></script>

    <!-- Javascript for page -->
    <script language="JavaScript">
    /* build a description of this page including SHA, source location on git repo and
       build time, the project's launchpad bug tag and set the HREF of the bug buttons */

        var lineFeed = "%0A";

        /* gitsha, project and bug_tag rely on variables in conf.py */
        var gitSha = "SHA: f7a37b8ab67b5fbe8597432774a12df3186c2e65"
        var bugTitle = "Certificates for PKI in Cloud Administrator Guide"
        var fieldTags = "admin-guide-cloud"

        /* "last_updated" is the build date and time. It relies on the
           conf.py variable "html_last_updated_fmt", which should include
           year/month/day as well as hours and minutes                   */
        var buildstring = "Release: 0.9 on 2015-10-23 15:47"

        var fieldComment = encodeURI(buildstring) +
                           lineFeed + encodeURI(gitSha) +
                           lineFeed + encodeURI(gitlink)

        logABug(bugTitle, fieldComment, fieldTags)
    </script>
    <!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
        (function() {
        var cx = '000108871792296872333:noj9nikm74i';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' :
'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
       </script>

 </body>
</html>