<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

  <title>OpenStack Docs: Configure migrations</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<!-- CSS references are in the css.html template -->
    <!-- Bootstrap Core CSS -->
    <link href="_static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Pygments css -->
    <link href="_static/css/native.css" rel="stylesheet">

    <!-- Fonts -->
    <!--<link href="font-awesome.min.css" rel="stylesheet">-->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

	<!-- BB: theme style sheets moved here so that theme rules aren't 
	     overridden by awesome rules. Should they go after the scripts below? -->
    <!-- Custom CSS -->
    <link href="_static/css/combined.css" rel="stylesheet">
    <link href="_static/css/styles.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Page-specific CSS -->
  
  
 </head>
 <body>
    <!-- Header -->
        <!-- Header Navigation -->
        <nav class="navbar navbar-default inner" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
             <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
      <span class="sr-only">
      Toggle navigation
      </span>
      <span class="icon-bar">
      </span>
      <span class="icon-bar">
      </span>
      <span class="icon-bar">
      </span>
      </button>
                <div class="brand-wrapper">
                    <a class="navbar-brand" href="/"></a>
                </div>
                <div class="search-icon show"><i class="fa fa-search"></i>
Search</div>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling
-->
            <div class="collapse navbar-collapse"
id="bs-example-navbar-collapse-1">
                <div class="search-container tiny">



  <div id="gcse">
    <script type="text/javascript">
      (function() {
        var cx = '000108871792296872333:noj9nikm74i';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' :
'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:search gname="standard"></gcse:search>
  </div>


                    <i class="fa fa-times close-search"></i>
                </div>
                    <ul class="nav navbar-nav navbar-main show">
                        <li>



  <div id="gcse-mobile">
    <gcse:search gname="mobile"></gcse:search>
  </div>


                        </li>


                        <li>

                                <a href="http://www.openstack.org/software/" class="drop"
id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuSoftware">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-compute/">Compute</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-storage/">Storage</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-networking/">Networking</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-dashboard/">Dashboard</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-shared-services/">Shared Services</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get
Started</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/user-stories/" class="drop"
id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuUsers">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//superuser.openstack.org/">Superuser
Magazine</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/enterprise/auto/">Featured:  Top 10
Automaker</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/community/" class="drop"
id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuCommunity">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//ask.openstack.org/">Ask A Technical
Question</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//wiki.openstack.org/wiki/Main_Page">OpenStack Wiki</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/events/">Community Events</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//wiki.openstack.org/wiki/Getting_The_Code">Source Code</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/foundation/companies/">Supporting Companies</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/jobs/">Jobs</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//www.openstack.org/join/">Join The
Community</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/marketplace/">Marketplace</a>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/events/" class="drop"
id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuEvents">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/events/">Overview</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/summit/openstack-paris-summit-2014/">The OpenStack
Summit</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More
OpenStack Events</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/blog/">Blog</a>

                        </li>

                        <li>

                                <a href="http://docs.openstack.org/">Docs</a>

                        </li>


                        <li>
                            <a href="http://openstack.org/Security/login/"
class="sign-in-btn">Sign In</a>
                        </li>
                    </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Begin Page Content -->
        <div class="container docs-book-wrapper">
        <div class="row">
            <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<!-- Row with title and buttons-->
            <div class="row">
                <div class="col-lg-8">
                <h2>Configure migrations</h2>
                </div>
<div class="docs-actions">
                  
                  <a href="compute-root-wrap-reference.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Secure with rootwrap"></i></a>
                  
                  
                  <a href="compute-live-migration-usage.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Migrate instances"></i></a>
                  
                  <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
                </div>
            </div>
            <div class="row docs-byline">
                <div class="docs-updated">
                    updated: 2015-10-23 15:47 | release: 0.9
                </div>
                <a href="http://git.openstack.org/" class="docs-edit">
                    <i class="fa fa-pencil"></i> suggest edits
                </a>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="docs-top-contents">
                    <h5>Contents</h5>
                    <ul>
<li><a class="reference internal" href="#">Configure migrations</a><ul>
<li><a class="reference internal" href="#kvm-libvirt">KVM-Libvirt</a><ul>
<li><a class="reference internal" href="#shared-storage">Shared storage</a></li>
<li><a class="reference internal" href="#example-compute-installation-environment">Example Compute installation environment</a></li>
<li><a class="reference internal" href="#enabling-true-live-migration">Enabling true live migration</a></li>
<li><a class="reference internal" href="#block-migration">Block migration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#xenserver">XenServer</a><ul>
<li><a class="reference internal" href="#configuring-migrations-xenserver-shared-storage">Shared storage</a></li>
<li><a class="reference internal" href="#configuring-migrations-xenserver-block-migration">Block migration</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                    </div>
                <div class="docs-body">

  <div class="section" id="configure-migrations">
<span id="section-configuring-compute-migrations"></span><h1>Configure migrations<a class="headerlink" href="#configure-migrations" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only cloud administrators can perform live migrations. If your cloud
is configured to use cells, you can perform live migration within
but not between cells.</p>
</div>
<p>Migration enables an administrator to move a virtual-machine instance
from one compute host to another. This feature is useful when a compute
host requires maintenance. Migration can also be useful to redistribute
the load when many VM instances are running on a specific physical
machine.</p>
<p>The migration types are:</p>
<ul class="simple">
<li><strong>Non-live migration</strong> (sometimes referred to simply as &#8216;migration&#8217;).
The instance is shut down for a period of time to be moved to another
hypervisor. In this case, the instance recognizes that it was
rebooted.</li>
<li><strong>Live migration</strong> (or &#8216;true live migration&#8217;). Almost no instance
downtime. Useful when the instances must be kept running during the
migration. The different types of live migration are:<ul>
<li><strong>Shared storage-based live migration</strong>. Both hypervisors have
access to shared storage.</li>
<li><strong>Block live migration</strong>. No shared storage is required.
Incompatible with read-only devices such as CD-ROMs and
<a class="reference external" href="http://docs.openstack.org/user-guide/cli_config_drive.html">Configuration Drive (config_drive)</a>.</li>
<li><strong>Volume-backed live migration</strong>. Instances are backed by volumes
rather than ephemeral disk, no shared storage is required, and
migration is supported (currently only available for libvirt-based
hypervisors).</li>
</ul>
</li>
</ul>
<p>The following sections describe how to configure your hosts and compute
nodes for migrations by using the KVM and XenServer hypervisors.</p>
<div class="section" id="kvm-libvirt">
<span id="configuring-migrations-kvm-libvirt"></span><h2>KVM-Libvirt<a class="headerlink" href="#kvm-libvirt" title="Permalink to this headline">¶</a></h2>
<div class="section" id="shared-storage">
<span id="configuring-migrations-kvm-shared-storage"></span><h3>Shared storage<a class="headerlink" href="#shared-storage" title="Permalink to this headline">¶</a></h3>
<p><strong>Prerequisites</strong></p>
<ul class="simple">
<li><strong>Hypervisor:</strong> KVM with libvirt</li>
<li><strong>Shared storage:</strong> <tt class="file docutils literal"><span class="pre">NOVA-INST-DIR/instances/</span></tt> (for example,
<tt class="file docutils literal"><span class="pre">/var/lib/nova/instances</span></tt>) has to be mounted by shared storage.
This guide uses NFS but other options, including the
<a class="reference external" href="http://gluster.org/community/documentation//index.php/OSConnect">OpenStack Gluster Connector</a>
are available.</li>
<li><strong>Instances:</strong> Instance can be migrated with iSCSI-based volumes.</li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li>Because the Compute service does not use the libvirt live
migration functionality by default, guests are suspended before
migration and might experience several minutes of downtime. For
details, see <cite>Enabling true live migration</cite>.</li>
<li>Compute calculates the amount of downtime required using the RAM size of
the disk being migrated, in accordance with the <tt class="docutils literal"><span class="pre">live_migration_downtime</span></tt>
configuration parameters. Migration downtime is measured in steps, with an
exponential backoff between each step. This means that the maximum
downtime between each step starts off small, and is increased in ever
larger amounts as Compute waits for the migration to complete. This gives
the guest a chance to complete the migration successfully, with a minimum
amount of downtime.</li>
<li>This guide assumes the default value for <tt class="docutils literal"><span class="pre">instances_path</span></tt> in
your <tt class="file docutils literal"><span class="pre">nova.conf</span></tt> file (<tt class="file docutils literal"><span class="pre">NOVA-INST-DIR/instances</span></tt>). If you
have changed the <tt class="docutils literal"><span class="pre">state_path</span></tt> or <tt class="docutils literal"><span class="pre">instances_path</span></tt> variables,
modify the commands accordingly.</li>
<li>You must specify <tt class="docutils literal"><span class="pre">vncserver_listen=0.0.0.0</span></tt> or live migration
will not work correctly.</li>
<li>You must specify the <tt class="docutils literal"><span class="pre">instances_path</span></tt> in each node that runs
nova-compute. The mount point for <tt class="docutils literal"><span class="pre">instances_path</span></tt> must be the
same value for each node, or live migration will not work
correctly.</li>
</ul>
</div>
<div class="section" id="example-compute-installation-environment">
<span id="section-example-compute-install"></span><h3>Example Compute installation environment<a class="headerlink" href="#example-compute-installation-environment" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Prepare at least three servers. In this example, we refer to the
servers as <tt class="docutils literal"><span class="pre">HostA</span></tt>, <tt class="docutils literal"><span class="pre">HostB</span></tt>, and <tt class="docutils literal"><span class="pre">HostC</span></tt>:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">HostA</span></tt> is the Cloud Controller, and should run these services:
nova-api, nova-scheduler, <tt class="docutils literal"><span class="pre">nova-network</span></tt>, cinder-volume, and
<tt class="docutils literal"><span class="pre">nova-objectstore</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">HostB</span></tt> and <tt class="docutils literal"><span class="pre">HostC</span></tt> are the compute nodes that run
nova-compute.</li>
</ul>
<p>Ensure that <tt class="docutils literal"><span class="pre">NOVA-INST-DIR</span></tt> (set with <tt class="docutils literal"><span class="pre">state_path</span></tt> in the
<tt class="file docutils literal"><span class="pre">nova.conf</span></tt> file) is the same on all hosts.</p>
</li>
<li><p class="first">In this example, <tt class="docutils literal"><span class="pre">HostA</span></tt> is the NFSv4 server that exports
<tt class="docutils literal"><span class="pre">NOVA-INST-DIR/instances</span></tt> directory. <tt class="docutils literal"><span class="pre">HostB</span></tt> and <tt class="docutils literal"><span class="pre">HostC</span></tt> are
NFSv4 clients that mount <tt class="docutils literal"><span class="pre">HostA</span></tt>.</p>
</li>
</ul>
<p><strong>Configuring your system</strong></p>
<ol class="arabic">
<li><p class="first">Configure your DNS or <tt class="docutils literal"><span class="pre">/etc/hosts</span></tt> and ensure it is consistent across
all hosts. Make sure that the three hosts can perform name resolution
with each other. As a test, use the <strong class="command">ping</strong> command to ping each host
from one another:</p>
<div class="code console highlight-python"><div class="highlight"><pre>$ ping HostA
$ ping HostB
$ ping HostC
</pre></div>
</div>
</li>
<li><p class="first">Ensure that the UID and GID of your Compute and libvirt users are
identical between each of your servers. This ensures that the
permissions on the NFS mount works correctly.</p>
</li>
<li><p class="first">Ensure you can access SSH without a password and without
StrictHostKeyChecking between <tt class="docutils literal"><span class="pre">HostB</span></tt> and <tt class="docutils literal"><span class="pre">HostC</span></tt> as <tt class="docutils literal"><span class="pre">nova</span></tt>
user (set with the owner of nova-compute service). Direct access
from one compute host to another is needed to copy the VM file
across. It is also needed to detect if the source and target
compute nodes share a storage subsystem.</p>
</li>
<li><p class="first">Export <tt class="docutils literal"><span class="pre">NOVA-INST-DIR/instances</span></tt> from <tt class="docutils literal"><span class="pre">HostA</span></tt>, and ensure it is
readable and writable by the Compute user on <tt class="docutils literal"><span class="pre">HostB</span></tt> and <tt class="docutils literal"><span class="pre">HostC</span></tt>.</p>
<p>For more information, see: <a class="reference external" href="https://help.ubuntu.com/community/SettingUpNFSHowTo">SettingUpNFSHowTo</a>
or <a class="reference external" href="http://www.cyberciti.biz/faq/centos-fedora-rhel-nfs-v4-configuration/">CentOS/Red Hat: Setup NFS v4.0 File Server</a></p>
</li>
<li><p class="first">Configure the NFS server at <tt class="docutils literal"><span class="pre">HostA</span></tt> by adding the following line to
the <tt class="file docutils literal"><span class="pre">/etc/exports</span></tt> file:</p>
<div class="code ini highlight-python"><div class="highlight"><pre>NOVA-INST-DIR/instances HostA/255.255.0.0(rw,sync,fsid=0,no_root_squash)
</pre></div>
</div>
<p>Change the subnet mask (<tt class="docutils literal"><span class="pre">255.255.0.0</span></tt>) to the appropriate value to
include the IP addresses of <tt class="docutils literal"><span class="pre">HostB</span></tt> and <tt class="docutils literal"><span class="pre">HostC</span></tt>. Then restart the
NFS server:</p>
<div class="code console highlight-python"><div class="highlight"><pre><span class="c"># /etc/init.d/nfs-kernel-server restart</span>
<span class="c"># /etc/init.d/idmapd restart</span>
</pre></div>
</div>
</li>
<li><p class="first">On both compute nodes, enable the &#8216;execute/search&#8217; bit on your shared
directory to allow qemu to be able to use the images within the
directories. On all hosts, run the following command:</p>
<div class="code console highlight-python"><div class="highlight"><pre>$ chmod o+x NOVA-INST-DIR/instances
</pre></div>
</div>
</li>
<li><p class="first">Configure NFS on <tt class="docutils literal"><span class="pre">HostB</span></tt> and <tt class="docutils literal"><span class="pre">HostC</span></tt> by adding the following line to
the <tt class="file docutils literal"><span class="pre">/etc/fstab</span></tt> file</p>
<div class="code console highlight-python"><div class="highlight"><pre>HostA:/ /NOVA-INST-DIR/instances nfs4 defaults 0 0
</pre></div>
</div>
<p>Ensure that you can mount the exported directory</p>
<div class="code console highlight-python"><div class="highlight"><pre>$ mount -a -v
</pre></div>
</div>
<p>Check that <tt class="docutils literal"><span class="pre">HostA</span></tt> can see the <tt class="file docutils literal"><span class="pre">NOVA-INST-DIR/instances/</span></tt>
directory</p>
<div class="code console highlight-python"><div class="highlight"><pre>$ ls -ld NOVA-INST-DIR/instances/
drwxr-xr-x 2 nova nova 4096 2012-05-19 14:34 nova-install-dir/instances/
</pre></div>
</div>
<p>Perform the same check on <tt class="docutils literal"><span class="pre">HostB</span></tt> and <tt class="docutils literal"><span class="pre">HostC</span></tt>, paying special
attention to the permissions (Compute should be able to write)</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> ls -ld NOVA-INST-DIR/instances/
<span class="go">drwxr-xr-x 2 nova nova 4096 2012-05-07 14:34 nova-install-dir/instances/</span>

<span class="gp">$</span> df -k
<span class="go">Filesystem           1K-blocks      Used Available Use% Mounted on</span>
<span class="go">/dev/sda1            921514972   4180880 870523828   1% /</span>
<span class="go">none                  16498340      1228  16497112   1% /dev</span>
<span class="go">none                  16502856         0  16502856   0% /dev/shm</span>
<span class="go">none                  16502856       368  16502488   1% /var/run</span>
<span class="go">none                  16502856         0  16502856   0% /var/lock</span>
<span class="go">none                  16502856         0  16502856   0% /lib/init/rw</span>
<span class="go">HostA:               921515008 101921792 772783104  12% /var/lib/nova/instances  ( &lt;--- this line is important.)</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the libvirt configurations so that the calls can be made
securely. These methods enable remote access over TCP and are not
documented here.</p>
<ul class="simple">
<li>SSH tunnel to libvirtd&#8217;s UNIX socket</li>
<li>libvirtd TCP socket, with GSSAPI/Kerberos for auth+data encryption</li>
<li>libvirtd TCP socket, with TLS for encryption and x509 client certs
for authentication</li>
<li>libvirtd TCP socket, with TLS for encryption and Kerberos for
authentication</li>
</ul>
<p>Restart libvirt. After you run the command, ensure that libvirt is
successfully restarted</p>
<div class="code console highlight-python"><div class="highlight"><pre># stop libvirt-bin &amp;&amp; start libvirt-bin
$ ps -ef | grep libvirt
root 1145 1 0 Nov27 ? 00:00:03 /usr/sbin/libvirtd -d -l\
</pre></div>
</div>
</li>
<li><p class="first">Configure your firewall to allow libvirt to communicate between nodes.
By default, libvirt listens on TCP port 16509, and an ephemeral TCP
range from 49152 to 49261 is used for the KVM communications. Based on
the secure remote access TCP configuration you chose, be careful which
ports you open, and always understand who has access. For information
about ports that are used with libvirt,
see the <a class="reference external" href="http://libvirt.org/remote.html#Remote_libvirtd_configuration">libvirt documentation</a>.</p>
</li>
<li><p class="first">Configure the downtime required for the migration by adjusting these
parameters in the <tt class="file docutils literal"><span class="pre">nova.conf</span></tt> file:</p>
<div class="code ini highlight-python"><div class="highlight"><pre><span class="n">live_migration_downtime</span>
<span class="n">live_migration_downtime_steps</span>
<span class="n">live_migration_downtime_delay</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">live_migration_downtime</span></tt> parameter sets the maximum permitted
downtime for a live migration, in milliseconds. This setting defaults to
500 milliseconds.</p>
<p>The <tt class="docutils literal"><span class="pre">live_migration_downtime_steps</span></tt> parameter sets the total number of
incremental steps to reach the maximum downtime value. This setting
defaults to 10 steps.</p>
<p>The <tt class="docutils literal"><span class="pre">live_migration_downtime_delay</span></tt> parameter sets the amount of time
to wait between each step, in seconds. This setting defaults to 75 seconds.</p>
</li>
<li><p class="first">You can now configure other options for live migration. In most cases, you
will not need to configure any options. For advanced configuration options,
see the <a class="reference external" href="http://docs.openstack.org/liberty/config-reference/content/list-of-compute-config-options.html#config_table_nova_livemigration">OpenStack Configuration Reference Guide</a>.</p>
</li>
</ol>
</div>
<div class="section" id="enabling-true-live-migration">
<span id="true-live-migration-kvm-libvirt"></span><h3>Enabling true live migration<a class="headerlink" href="#enabling-true-live-migration" title="Permalink to this headline">¶</a></h3>
<p>Prior to the Kilo release, the Compute service did not use the libvirt
live migration function by default. To enable this function, add the
following line to the <tt class="docutils literal"><span class="pre">[libvirt]</span></tt> section of the <tt class="file docutils literal"><span class="pre">nova.conf</span></tt> file:</p>
<div class="code ini highlight-python"><div class="highlight"><pre><span class="n">live_migration_flag</span><span class="o">=</span><span class="n">VIR_MIGRATE_UNDEFINE_SOURCE</span><span class="p">,</span><span class="n">VIR_MIGRATE_PEER2PEER</span><span class="p">,</span><span class="n">VIR_MIGRATE_LIVE</span><span class="p">,</span><span class="n">VIR_MIGRATE_TUNNELLED</span>
</pre></div>
</div>
<p>On versions older than Kilo, the Compute service does not use libvirt&#8217;s
live migration by default because there is a risk that the migration
process will never end. This can happen if the guest operating system
uses blocks on the disk faster than they can be migrated.</p>
</div>
<div class="section" id="block-migration">
<span id="configuring-migrations-kvm-block-migration"></span><h3>Block migration<a class="headerlink" href="#block-migration" title="Permalink to this headline">¶</a></h3>
<p>Configuring KVM for block migration is exactly the same as the above
configuration in <a class="reference internal" href="#configuring-migrations-kvm-shared-storage"><em>Shared storage</em></a>
the section called shared storage, except that <tt class="docutils literal"><span class="pre">NOVA-INST-DIR/instances</span></tt>
is local to each host rather than shared. No NFS client or server
configuration is required.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>To use block migration, you must use the <em class="xref std std-option">--block-migrate</em>
parameter with the live migration command.</li>
<li>Block migration is incompatible with read-only devices such as
CD-ROMs and <a class="reference external" href="http://docs.openstack.org/user-guide/cli_config_drive.html">Configuration Drive (config_drive)</a>.</li>
<li>Since the ephemeral drives are copied over the network in block
migration, migrations of instances with heavy I/O loads may never
complete if the drives are writing faster than the data can be
copied over the network.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="xenserver">
<span id="configuring-migrations-xenserver"></span><h2>XenServer<a class="headerlink" href="#xenserver" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuring-migrations-xenserver-shared-storage">
<span id="id2"></span><h3>Shared storage<a class="headerlink" href="#configuring-migrations-xenserver-shared-storage" title="Permalink to this headline">¶</a></h3>
<p><strong>Prerequisites</strong></p>
<ul>
<li><p class="first"><strong>Compatible XenServer hypervisors</strong>. For more information, see the
<a class="reference external" href="http://docs.vmd.citrix.com/XenServer/6.0.0/1.0/en_gb/reference.html#pooling_homogeneity_requirements">Requirements for Creating Resource Pools</a> section of the XenServer
Administrator&#8217;s Guide.</p>
</li>
<li><p class="first"><strong>Shared storage</strong>. An NFS export, visible to all XenServer hosts.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the supported NFS versions, see the
<a class="reference external" href="http://docs.vmd.citrix.com/XenServer/6.0.0/1.0/en_gb/reference.html#id1002701">NFS VHD</a>
section of the XenServer Administrator&#8217;s Guide.</p>
</div>
</li>
</ul>
<p>To use shared storage live migration with XenServer hypervisors, the
hosts must be joined to a XenServer pool. To create that pool, a host
aggregate must be created with specific metadata. This metadata is used
by the XAPI plug-ins to establish the pool.</p>
<p><strong>Using shared storage live migrations with XenServer Hypervisors</strong></p>
<ol class="arabic">
<li><p class="first">Add an NFS VHD storage to your master XenServer, and set it as the
default storage repository. For more information, see NFS VHD in the
XenServer Administrator&#8217;s Guide.</p>
</li>
<li><p class="first">Configure all compute nodes to use the default storage repository
(<tt class="docutils literal"><span class="pre">sr</span></tt>) for pool operations. Add this line to your <tt class="file docutils literal"><span class="pre">nova.conf</span></tt>
configuration files on all compute nodes:</p>
<div class="code ini highlight-python"><div class="highlight"><pre>sr_matching_filter=default-sr:true
</pre></div>
</div>
</li>
<li><p class="first">Create a host aggregate. This command creates the aggregate, and then
displays a table that contains the ID of the new aggregate</p>
<div class="code console highlight-python"><div class="highlight"><pre>$ nova aggregate-create POOL_NAME AVAILABILITY_ZONE
</pre></div>
</div>
<p>Add metadata to the aggregate, to mark it as a hypervisor pool</p>
<div class="code console highlight-python"><div class="highlight"><pre>$ nova aggregate-set-metadata AGGREGATE_ID hypervisor_pool=true

$ nova aggregate-set-metadata AGGREGATE_ID operational_state=created
</pre></div>
</div>
<p>Make the first compute node part of that aggregate</p>
<div class="code console highlight-python"><div class="highlight"><pre>$ nova aggregate-add-host AGGREGATE_ID MASTER_COMPUTE_NAME
</pre></div>
</div>
<p>The host is now part of a XenServer pool.</p>
</li>
<li><p class="first">Add hosts to the pool</p>
<div class="code console highlight-python"><div class="highlight"><pre>$ nova aggregate-add-host AGGREGATE_ID COMPUTE_HOST_NAME
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The added compute node and the host will shut down to join the host
to the XenServer pool. The operation will fail if any server other
than the compute node is running or suspended on the host.</p>
</div>
</li>
</ol>
</div>
<div class="section" id="configuring-migrations-xenserver-block-migration">
<span id="id3"></span><h3>Block migration<a class="headerlink" href="#configuring-migrations-xenserver-block-migration" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><strong>Compatible XenServer hypervisors</strong>.
The hypervisors must support the Storage XenMotion feature.
See your XenServer manual to make sure your edition
has this feature.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>To use block migration, you must use the <em class="xref std std-option">--block-migrate</em>
parameter with the live migration command.</li>
<li>Block migration works only with EXT local storage storage
repositories, and the server must not have any volumes attached.</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>


              </div>
          </div>
          </div>
          <!-- <div class="docs-tags">
                <a href="#" class="docs-tag">Network Time Protocol (NTP)</a>
                <a href="#" class="docs-tag">Security</a>
                <a href="#" class="docs-tag">Conceptual architecture</a>
            </div> -->
<div class="docs-actions">
                  
                  <a href="compute-root-wrap-reference.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Secure with rootwrap"></i></a>
                  
                  
                  <a href="compute-live-migration-usage.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Migrate instances"></i></a>
                  
                  <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
                </div>
                <div class="row docs-byline bottom">
                <div class="docs-updated">
                updated: 2015-10-23 15:47 | release: 0.9
                </div>
                <a href="http://git.openstack.org/" class="docs-edit">
                    <i class="fa fa-pencil"></i> suggest edits
                </a>
</div>
    <div class="row">
         <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
           <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
<p>
 Except where otherwise noted, this document is licensed under Creative Commons
 Attribution 3.0 License
 <a href="#">http://creativecommons.org/licenses/by/3.0/legalcode</a>.
</p>
<p>
 <a href="http://www.openstack.org/legal">See All Legal Notices</a>
</p>
         </div>
         <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
                    <!-- ID buglinkbottom added so that pre-filled doc bugs
                    are sent to Launchpad projects related to the document -->
                    <a href="#" id="logABugLink2" class="docs-footer-actions">
                        <i class="fa fa-bug"></i>found an error? report a bug
                    </a>
                    <a href="http://ask.openstack.org" class="docs-footer-actions">
                        <i class="fa fa-question-circle"></i>questions? <a href="http://ask.openstack.org/">ask.openstack.org</a>
                    </a>
                </div>
     </div>
     </div>
            <!-- Docs Sidebar -->
                <div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
            <div class="search-icon show"><i class="fa fa-search"></i>
Search</div>
            <div class="btn-group docs-sidebar-releases">
                <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
                <button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">Release: Kilo (April 2015)<i class="fa fa-caret-down"></i></button>
                <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
                    <li role="presentation" class="dropdown-header">Releases</li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/kilo/">Kilo (current release)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/juno/">Juno (October 2014)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/icehouse/">Icehouse (May 2014)</a></li>
                    <li role="presentation" class="dropdown-header">Languages</li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/ja/">日本語 (Japanese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/de/">Deutsch (German)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/fr/">Français (French)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/pt_BR/">Português (Portuguese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/zh_CN/">简体中文 (Simplified Chinese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/ko_KR/">한국어 (Korean)</a></li>
                </ul>
            </div>
                <div class="docs-sidebar-toc">
                    <div class="docs-sidebar-section" id="install-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#install-guides"><h4>Install Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="user-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#user-guides"><h4>User Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="configuration-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#configuration-guides"><h4>Configuration Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="operations-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/openstack-ops/content/"><h4>Operations Guide</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="api-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#api-guides"><h4>API Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="contributor-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#contributor-guides"><h4>Contributor Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="table-of-contents">
                        <a class="docs-sidebar-section-title"><h4>Contents</h4></a>
                        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/get_started_with_openstack.html">Get started with OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="identity_management.html">Identity management</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Dashboard</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="compute.html">Compute</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="compute_arch.html">System architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute-images-instances.html">Images and instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute-networking-nova.html">Networking with nova-network</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="compute-system-admin.html">System administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="common/support-compute.html">Troubleshoot Compute</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="objectstorage.html">Object Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="blockstorage.html">Block Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="shared_file_systems.html">Shared File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="telemetry.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="baremetal.html">Bare Metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html">Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_project.html">Cross-project features</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/app_support.html">Community support</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

                    </div>
                </div>
                </div>

</div>
</div>
    <!-- End Page Content -->

    <!-- Footer -->
    <!-- Footer -->
        <footer>
        <div class="container">
            <div class="row footer-links">
                <div class="col-lg-2 col-sm-2">
                    <h3>OpenStack</h3>
                    <ul>
                        <li><a href="/foundation">About the Foundation</a></li>
                        <li><a
href="http://openstack.org/projects/">Projects</a></li>
                        <li><a
href="http://openstack.org/projects/openstack-security/">OpenStack
Security</a></li>
                        <li><a
href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
                        <li><a href="http://openstack.org/blog/">Blog</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Community</h3>
                    <ul>
                        <li><a href="http://openstack.org/community/">User
Groups</a></li>
                        <li><a
href="http://openstack.org/community/events/">Events</a></li>
                        <li><a
href="http://openstack.org/community/jobs/">Jobs</a></li>
                        <li><a
href="http://openstack.org/foundation/companies/">Companies</a></li>
                        <li><a
href="https://wiki.openstack.org/wiki/How_To_Contribute">Contribute</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Documentation</h3>
                    <ul>
                        <li><a href="http://docs.openstack.org">OpenStack
Manuals</a></li>
                        <li><a
href="http://openstack.org/software/start/">Getting Started</a></li>
                        <li><a href="http://developer.openstack.org">API
Documentation</a></li>
                        <li><a href="https://wiki.openstack.org">Wiki</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Branding & Legal</h3>
                    <ul>
                        <li><a href="http://openstack.org/brand/">Logos &
Guidelines</a></li>
                        <li><a
href="http://openstack.org/brand/openstack-trademark-policy/">Trademark
Policy</a></li>
                        <li><a href="http://openstack.org/privacy/">Privacy
Policy</a></li>
                        <li><a
href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributors_License_Agreement">OpenStack
CLA</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-sm-4">
                    <h3>Stay In Touch</h3>
                    <a href="https://twitter.com/OpenStack" target="_blank"
class="social-icons footer-twitter"></a>
                    <a href="https://www.facebook.com/openstack"
target="_blank" class="social-icons footer-facebook"></a>
                    <a href="https://www.linkedin.com/company/openstack"
target="_blank" class="social-icons footer-linkedin"></a>
                    <a href="https://www.youtube.com/user/OpenStackFoundation"
target="_blank" class="social-icons footer-youtube"></a>
                    <!-- <form class="form-inline">
                        <div class="form-group newsletter-form">
                            <label>Join Our Newsletter</label>
                            <input class="newsletter-input" type="input"
placeholder="Email">
                            <button type="submit"
class="newsletter-btn">Join</button>
                        </div>
                    </form> -->
                    <p class="fine-print">
                        The OpenStack project is provided under the Apache 2.0
license. Openstack.org is powered by <a href="http://rackspace.com"
target="_blank">Rackspace Cloud Computing</a>.
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <div class="footer-bottom">
        <div class="container">
            <form class="form-inline" id="FeedbackForm_FeedbackForm" action="/home/FeedbackForm" method="post" enctype="application/x-www-form-urlencoded">
              <div class="form-group">
                <div>
                  <input class="feedback-input" type="input" placeholder="Give Us Your Feedback On This Page">
                  <button type="submit" class="feedback-btn">Submit</button>
                </div>
              </div>
            </form>
        </div>
    </div>

<!-- Scripts in: static directory-->
    <!-- jQuery Version 1.11.0 -->
    <script type="text/javascript" src="_static/js/jquery-1.11.3.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

    <!-- The rest of the JS -->
    <script type="text/javascript" src="_static/js/navigation.js"></script>

    <!-- Docs JS -->
    <script type="text/javascript" src="_static/js/docs.js"></script>

    <!-- Popovers -->
    <script type="text/javascript" src="_static/js/webui-popover.js"></script>

    <!-- Javascript for page -->
    <script language="JavaScript">
    /* build a description of this page including SHA, source location on git repo and
       build time, the project's launchpad bug tag and set the HREF of the bug buttons */

        var lineFeed = "%0A";

        /* gitsha, project and bug_tag rely on variables in conf.py */
        var gitSha = "SHA: f7a37b8ab67b5fbe8597432774a12df3186c2e65"
        var bugTitle = "Configure migrations in Cloud Administrator Guide"
        var fieldTags = "admin-guide-cloud"

        /* "last_updated" is the build date and time. It relies on the
           conf.py variable "html_last_updated_fmt", which should include
           year/month/day as well as hours and minutes                   */
        var buildstring = "Release: 0.9 on 2015-10-23 15:47"

        var fieldComment = encodeURI(buildstring) +
                           lineFeed + encodeURI(gitSha) +
                           lineFeed + encodeURI(gitlink)

        logABug(bugTitle, fieldComment, fieldTags)
    </script>
    <!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
        (function() {
        var cx = '000108871792296872333:noj9nikm74i';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' :
'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
       </script>

 </body>
</html>