<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

  <title>OpenStack Docs: Configure and use driver filter and weighing for scheduler</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
<!-- CSS references are in the css.html template -->
    <!-- Bootstrap Core CSS -->
    <link href="_static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Pygments css -->
    <link href="_static/css/native.css" rel="stylesheet">

    <!-- Fonts -->
    <!--<link href="font-awesome.min.css" rel="stylesheet">-->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

	<!-- BB: theme style sheets moved here so that theme rules aren't 
	     overridden by awesome rules. Should they go after the scripts below? -->
    <!-- Custom CSS -->
    <link href="_static/css/combined.css" rel="stylesheet">
    <link href="_static/css/styles.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Page-specific CSS -->
  
  
 </head>
 <body>
    <!-- Header -->
        <!-- Header Navigation -->
        <nav class="navbar navbar-default inner" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
             <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
      <span class="sr-only">
      Toggle navigation
      </span>
      <span class="icon-bar">
      </span>
      <span class="icon-bar">
      </span>
      <span class="icon-bar">
      </span>
      </button>
                <div class="brand-wrapper">
                    <a class="navbar-brand" href="/"></a>
                </div>
                <div class="search-icon show"><i class="fa fa-search"></i>
Search</div>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling
-->
            <div class="collapse navbar-collapse"
id="bs-example-navbar-collapse-1">
                <div class="search-container tiny">



  <div id="gcse">
    <script type="text/javascript">
      (function() {
        var cx = '000108871792296872333:noj9nikm74i';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' :
'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:search gname="standard"></gcse:search>
  </div>


                    <i class="fa fa-times close-search"></i>
                </div>
                    <ul class="nav navbar-nav navbar-main show">
                        <li>



  <div id="gcse-mobile">
    <gcse:search gname="mobile"></gcse:search>
  </div>


                        </li>


                        <li>

                                <a href="http://www.openstack.org/software/" class="drop"
id="dropdownMenuSoftware">Software <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuSoftware">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/software/">Overview</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-compute/">Compute</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-storage/">Storage</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-networking/">Networking</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-dashboard/">Dashboard</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/software/openstack-shared-services/">Shared Services</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/software/start/">Get
Started</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/user-stories/" class="drop"
id="dropdownMenuUsers">Users <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuUsers">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/user-stories/">Overview</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//superuser.openstack.org/">Superuser
Magazine</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="http://www.openstack.org/enterprise/auto/">Featured:  Top 10
Automaker</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/community/" class="drop"
id="dropdownMenuCommunity">Community <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuCommunity">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="http://www.openstack.org/community/">Welcome! Start Here</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//ask.openstack.org/">Ask A Technical
Question</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//wiki.openstack.org/wiki/Main_Page">OpenStack Wiki</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/events/">Community Events</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//wiki.openstack.org/wiki/Getting_The_Code">Source Code</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/foundation/companies/">Supporting Companies</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/jobs/">Jobs</a></li>



                                            <li role="presentation"
class="divider"></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//www.openstack.org/join/">Join The
Community</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/marketplace/">Marketplace</a>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/events/" class="drop"
id="dropdownMenuEvents">Events <i class="fa fa-caret-down"></i></a>
                                <ul class="dropdown-menu" role="menu"
aria-labelledby="dropdownMenuEvents">


                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/community/events/">Overview</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1"
href="//www.openstack.org/summit/openstack-paris-summit-2014/">The OpenStack
Summit</a></li>



                                            <li role="presentation"><a
role="menuitem" tabindex="-1" href="//www.openstack.org/community/events/">More
OpenStack Events</a></li>


                                </ul>

                        </li>

                        <li>

                                <a href="http://www.openstack.org/blog/">Blog</a>

                        </li>

                        <li>

                                <a href="http://docs.openstack.org/">Docs</a>

                        </li>


                        <li>
                            <a href="http://openstack.org/Security/login/"
class="sign-in-btn">Sign In</a>
                        </li>
                    </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Begin Page Content -->
        <div class="container docs-book-wrapper">
        <div class="row">
            <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<!-- Row with title and buttons-->
            <div class="row">
                <div class="col-lg-8">
                <h2>Configure and use driver filter and weighing for scheduler</h2>
                </div>
<div class="docs-actions">
                  
                  <a href="blockstorage-consistency-groups.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Consistency groups"></i></a>
                  
                  
                  <a href="blockstorage_ratelimit_volume_copy_bandwidth.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Rate-limit volume copy bandwidth"></i></a>
                  
                  <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
                </div>
            </div>
            <div class="row docs-byline">
                <div class="docs-updated">
                    updated: 2015-10-23 15:47 | release: 0.9
                </div>
                <a href="http://git.openstack.org/" class="docs-edit">
                    <i class="fa fa-pencil"></i> suggest edits
                </a>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="docs-top-contents">
                    <h5>Contents</h5>
                    <ul>
<li><a class="reference internal" href="#">Configure and use driver filter and weighing for scheduler</a><ul>
<li><a class="reference internal" href="#what-is-driver-filter-and-weigher-and-when-to-use-it">What is driver filter and weigher and when to use it</a></li>
<li><a class="reference internal" href="#enable-driver-filter-and-weighing">Enable driver filter and weighing</a></li>
<li><a class="reference internal" href="#defining-your-own-filter-and-goodness-functions">Defining your own filter and goodness functions</a></li>
<li><a class="reference internal" href="#supported-operations-in-filter-and-goodness-functions">Supported operations in filter and goodness functions</a></li>
<li><a class="reference internal" href="#available-properties-when-creating-custom-functions">Available properties when creating custom functions</a><ul>
<li><a class="reference internal" href="#host-stats-for-a-back-end">Host stats for a back end</a></li>
<li><a class="reference internal" href="#capabilities-specific-to-a-back-end">Capabilities specific to a back end</a></li>
<li><a class="reference internal" href="#requested-volume-properties">Requested volume properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extra-specs-for-the-requested-volume-type">Extra specs for the requested volume type</a></li>
<li><a class="reference internal" href="#current-qos-specs-for-the-requested-volume-type">Current QoS specs for the requested volume type</a></li>
<li><a class="reference internal" href="#driver-filter-and-weigher-usage-examples">Driver filter and weigher usage examples</a></li>
</ul>
</li>
</ul>

                    </div>
                <div class="docs-body">

  <div class="section" id="configure-and-use-driver-filter-and-weighing-for-scheduler">
<h1>Configure and use driver filter and weighing for scheduler<a class="headerlink" href="#configure-and-use-driver-filter-and-weighing-for-scheduler" title="Permalink to this headline">¶</a></h1>
<p>OpenStack Block Storage enables you to choose a volume back end based on
back-end specific properties by using the DriverFilter and
GoodnessWeigher for the scheduler. The driver filter and weigher
scheduling can help ensure that the scheduler chooses the best back end
based on requested volume properties as well as various back-end
specific properties.</p>
<div class="section" id="what-is-driver-filter-and-weigher-and-when-to-use-it">
<h2>What is driver filter and weigher and when to use it<a class="headerlink" href="#what-is-driver-filter-and-weigher-and-when-to-use-it" title="Permalink to this headline">¶</a></h2>
<p>The driver filter and weigher gives you the ability to more finely
control how the OpenStack Block Storage scheduler chooses the best back
end to use when handling a volume request. One example scenario where
using the driver filter and weigher can be if a back end that utilizes
thin-provisioning is used. The default filters use the <tt class="docutils literal"><span class="pre">free</span> <span class="pre">capacity</span></tt>
property to determine the best back end, but that is not always perfect.
If a back end has the ability to provide a more accurate back-end
specific value you can use that as part of the weighing. Another example
of when the driver filter and weigher can prove useful is if a back end
exists where there is a hard limit of 1000 volumes. The maximum volume
size is 500&nbsp;GB. Once 75% of the total space is occupied the performance
of the back end degrades. The driver filter and weigher can provide a
way for these limits to be checked for.</p>
</div>
<div class="section" id="enable-driver-filter-and-weighing">
<h2>Enable driver filter and weighing<a class="headerlink" href="#enable-driver-filter-and-weighing" title="Permalink to this headline">¶</a></h2>
<p>To enable the driver filter, set the <tt class="docutils literal"><span class="pre">scheduler_default_filters</span></tt> option in
the <tt class="file docutils literal"><span class="pre">cinder.conf</span></tt> file to <tt class="docutils literal"><span class="pre">DriverFilter</span></tt> or add it to the list if
other filters are already present.</p>
<p>To enable the goodness filter as a weigher, set the
<tt class="docutils literal"><span class="pre">scheduler_default_weighers</span></tt> option in the <tt class="file docutils literal"><span class="pre">cinder.conf</span></tt> file to
<tt class="docutils literal"><span class="pre">GoodnessWeigher</span></tt> or add it to the list if other weighers are already
present.</p>
<p>You can choose to use the <tt class="docutils literal"><span class="pre">DriverFilter</span></tt> without the
<tt class="docutils literal"><span class="pre">GoodnessWeigher</span></tt> or vice-versa. The filter and weigher working
together, however, create the most benefits when helping the scheduler
choose an ideal back end.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The support for the <tt class="docutils literal"><span class="pre">DriverFilter</span></tt> and <tt class="docutils literal"><span class="pre">GoodnessWeigher</span></tt> is
optional for back ends. If you are using a back end that does not
support the filter and weigher functionality you may not get the
full benefit.</p>
</div>
<p>Example <tt class="file docutils literal"><span class="pre">cinder.conf</span></tt> configuration file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">scheduler_default_filters</span> <span class="o">=</span> <span class="n">DriverFilter</span>
<span class="n">scheduler_default_weighers</span> <span class="o">=</span> <span class="n">GoodnessWeigher</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is useful to use the other filters and weighers available in
OpenStack in combination with these custom ones. For example, the
<tt class="docutils literal"><span class="pre">CapacityFilter</span></tt> and <tt class="docutils literal"><span class="pre">CapacityWeigher</span></tt> can be combined with
these.</p>
</div>
</div>
<div class="section" id="defining-your-own-filter-and-goodness-functions">
<h2>Defining your own filter and goodness functions<a class="headerlink" href="#defining-your-own-filter-and-goodness-functions" title="Permalink to this headline">¶</a></h2>
<p>You can define your own filter and goodness functions through the use of
various properties that OpenStack Block Storage has exposed. Properties
exposed include information about the volume request being made,
<tt class="docutils literal"><span class="pre">volume_type</span></tt> settings, and back-end specific information about drivers.
All of these allow for a lot of control over how the ideal back end for
a volume request will be decided.</p>
<p>The <tt class="docutils literal"><span class="pre">filter_function</span></tt> option is a string defining an equation that
will determine whether a back end should be considered as a potential
candidate in the scheduler.</p>
<p>The <tt class="docutils literal"><span class="pre">goodness_function</span></tt> option is a string defining an equation that
will rate the quality of the potential host (0 to 100, 0 lowest, 100
highest).</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Default values for the filter and goodness functions will be used
for each back end if you do not define them yourself. If complete
control is desired then a filter and goodness function should be
defined for each of the back ends in the <tt class="file docutils literal"><span class="pre">cinder.conf</span></tt> file.</p>
</div>
</div>
<div class="section" id="supported-operations-in-filter-and-goodness-functions">
<h2>Supported operations in filter and goodness functions<a class="headerlink" href="#supported-operations-in-filter-and-goodness-functions" title="Permalink to this headline">¶</a></h2>
<p>Below is a table of all the operations currently usable in custom filter
and goodness functions created by you:</p>
<table border="1" class="docutils">
<colgroup>
<col width="56%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operations</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>+, -, *, /, ^</td>
<td>standard math</td>
</tr>
<tr class="row-odd"><td>not, and, or, &amp;, |, !</td>
<td>logic</td>
</tr>
<tr class="row-even"><td>&gt;, &gt;=, &lt;, &lt;=, ==, &lt;&gt;, !=</td>
<td>equality</td>
</tr>
<tr class="row-odd"><td>+, -</td>
<td>sign</td>
</tr>
<tr class="row-even"><td>x ? a : b</td>
<td>ternary</td>
</tr>
<tr class="row-odd"><td>abs(x), max(x, y), min(x, y)</td>
<td>math helper functions</td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Syntax errors in filter or goodness strings defined by you will
cause errors to be thrown at volume request time.</p>
</div>
</div>
<div class="section" id="available-properties-when-creating-custom-functions">
<h2>Available properties when creating custom functions<a class="headerlink" href="#available-properties-when-creating-custom-functions" title="Permalink to this headline">¶</a></h2>
<p>There are various properties that can be used in either the
<tt class="docutils literal"><span class="pre">filter_function</span></tt> or the <tt class="docutils literal"><span class="pre">goodness_function</span></tt> strings. The properties allow
access to volume info, qos settings, extra specs, and so on.</p>
<p>The following properties and their sub-properties are currently
available for use:</p>
<div class="section" id="host-stats-for-a-back-end">
<h3>Host stats for a back end<a class="headerlink" href="#host-stats-for-a-back-end" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>host</dt>
<dd>The host&#8217;s name</dd>
<dt>volume_backend_name</dt>
<dd>The volume back end name</dd>
<dt>vendor_name</dt>
<dd>The vendor name</dd>
<dt>driver_version</dt>
<dd>The driver version</dd>
<dt>storage_protocol</dt>
<dd>The storage protocol</dd>
<dt>QoS_support</dt>
<dd>Boolean signifying whether QoS is supported</dd>
<dt>total_capacity_gb</dt>
<dd>The total capacity in GB</dd>
<dt>allocated_capacity_gb</dt>
<dd>The allocated capacity in GB</dd>
<dt>reserved_percentage</dt>
<dd>The reserved storage percentage</dd>
</dl>
</div>
<div class="section" id="capabilities-specific-to-a-back-end">
<h3>Capabilities specific to a back end<a class="headerlink" href="#capabilities-specific-to-a-back-end" title="Permalink to this headline">¶</a></h3>
<p>These properties are determined by the specific back end
you are creating filter and goodness functions for. Some back ends
may not have any properties available here.</p>
</div>
<div class="section" id="requested-volume-properties">
<h3>Requested volume properties<a class="headerlink" href="#requested-volume-properties" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>status</dt>
<dd>Status for the requested volume</dd>
<dt>volume_type_id</dt>
<dd>The volume type ID</dd>
<dt>display_name</dt>
<dd>The display name of the volume</dd>
<dt>volume_metadata</dt>
<dd>Any metadata the volume has</dd>
<dt>reservations</dt>
<dd>Any reservations the volume has</dd>
<dt>user_id</dt>
<dd>The volume&#8217;s user ID</dd>
<dt>attach_status</dt>
<dd>The attach status for the volume</dd>
<dt>display_description</dt>
<dd>The volume&#8217;s display description</dd>
<dt>id</dt>
<dd>The volume&#8217;s ID</dd>
<dt>replication_status</dt>
<dd>The volume&#8217;s replication status</dd>
<dt>snapshot_id</dt>
<dd>The volume&#8217;s snapshot ID</dd>
<dt>encryption_key_id</dt>
<dd>The volume&#8217;s encryption key ID</dd>
<dt>source_volid</dt>
<dd>The source volume ID</dd>
<dt>volume_admin_metadata</dt>
<dd>Any admin metadata for this volume</dd>
<dt>source_replicaid</dt>
<dd>The source replication ID</dd>
<dt>consistencygroup_id</dt>
<dd>The consistency group ID</dd>
<dt>size</dt>
<dd>The size of the volume in GB</dd>
<dt>metadata</dt>
<dd>General metadata</dd>
</dl>
<p>The property most used from here will most likely be the <tt class="docutils literal"><span class="pre">size</span></tt> sub-property.</p>
</div>
</div>
<div class="section" id="extra-specs-for-the-requested-volume-type">
<h2>Extra specs for the requested volume type<a class="headerlink" href="#extra-specs-for-the-requested-volume-type" title="Permalink to this headline">¶</a></h2>
<p>View the available properties for volume types by running:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cinder extra-specs-list
</pre></div>
</div>
</div>
<div class="section" id="current-qos-specs-for-the-requested-volume-type">
<h2>Current QoS specs for the requested volume type<a class="headerlink" href="#current-qos-specs-for-the-requested-volume-type" title="Permalink to this headline">¶</a></h2>
<p>View the available properties for volume types by running:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cinder qos-list
</pre></div>
</div>
<p>In order to access these properties in a custom string use the following
format:</p>
<p><tt class="docutils literal"><span class="pre">&lt;property&gt;.&lt;sub_property&gt;</span></tt></p>
</div>
<div class="section" id="driver-filter-and-weigher-usage-examples">
<h2>Driver filter and weigher usage examples<a class="headerlink" href="#driver-filter-and-weigher-usage-examples" title="Permalink to this headline">¶</a></h2>
<p>Below are examples for using the filter and weigher separately,
together, and using driver-specific properties.</p>
<p>Example <tt class="file docutils literal"><span class="pre">cinder.conf</span></tt> file configuration for customizing the filter
function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">default</span><span class="p">]</span>
<span class="n">scheduler_default_filters</span> <span class="o">=</span> <span class="n">DriverFilter</span>
<span class="n">enabled_backends</span> <span class="o">=</span> <span class="n">lvm</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lvm</span><span class="o">-</span><span class="mi">2</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">lvm</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">sample_LVM</span>
<span class="n">filter_function</span> <span class="o">=</span> <span class="s">&quot;volume.size &lt; 10&quot;</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">lvm</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">sample_LVM</span>
<span class="n">filter_function</span> <span class="o">=</span> <span class="s">&quot;volume.size &gt;= 10&quot;</span>
</pre></div>
</div>
<p>The above example will filter volumes to different back ends depending
on the size of the requested volume. Default OpenStack Block Storage
scheduler weighing is done. Volumes with a size less than 10&nbsp;GB are sent
to lvm-1 and volumes with a size greater than or equal to 10&nbsp;GB are sent
to lvm-2.</p>
<p>Example <tt class="file docutils literal"><span class="pre">cinder.conf</span></tt> file configuration for customizing the goodness
function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">default</span><span class="p">]</span>
<span class="n">scheduler_default_weighers</span> <span class="o">=</span> <span class="n">GoodnessWeigher</span>
<span class="n">enabled_backends</span> <span class="o">=</span> <span class="n">lvm</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lvm</span><span class="o">-</span><span class="mi">2</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">lvm</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">sample_LVM</span>
<span class="n">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(volume.size &lt; 5) ? 100 : 50&quot;</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">lvm</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">sample_LVM</span>
<span class="n">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(volume.size &gt;= 5) ? 100 : 25&quot;</span>
</pre></div>
</div>
<p>The above example will determine the goodness rating of a back end based
off of the requested volume&#8217;s size. Default OpenStack Block Storage
scheduler filtering is done. The example shows how the ternary if
statement can be used in a filter or goodness function. If a requested
volume is of size 10&nbsp;GB then lvm-1 is rated as 50 and lvm-2 is rated as
100. In this case lvm-2 wins. If a requested volume is of size 3&nbsp;GB then
lvm-1 is rated 100 and lvm-2 is rated 25. In this case lvm-1 would win.</p>
<p>Example <tt class="file docutils literal"><span class="pre">cinder.conf</span></tt> file configuration for customizing both the
filter and goodness functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">default</span><span class="p">]</span>
<span class="n">scheduler_default_filters</span> <span class="o">=</span> <span class="n">DriverFilter</span>
<span class="n">scheduler_default_weighers</span> <span class="o">=</span> <span class="n">GoodnessWeigher</span>
<span class="n">enabled_backends</span> <span class="o">=</span> <span class="n">lvm</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lvm</span><span class="o">-</span><span class="mi">2</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">lvm</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">sample_LVM</span>
<span class="n">filter_function</span> <span class="o">=</span> <span class="s">&quot;stats.total_capacity_gb &lt; 500&quot;</span>
<span class="n">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(volume.size &lt; 25) ? 100 : 50&quot;</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">lvm</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">sample_LVM</span>
<span class="n">filter_function</span> <span class="o">=</span> <span class="s">&quot;stats.total_capacity_gb &gt;= 500&quot;</span>
<span class="n">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(volume.size &gt;= 25) ? 100 : 75&quot;</span>
</pre></div>
</div>
<p>The above example combines the techniques from the first two examples.
The best back end is now decided based off of the total capacity of the
back end and the requested volume&#8217;s size.</p>
<p>Example <tt class="file docutils literal"><span class="pre">cinder.conf</span></tt> file configuration for accessing driver specific
properties:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">default</span><span class="p">]</span>
<span class="n">scheduler_default_filters</span> <span class="o">=</span> <span class="n">DriverFilter</span>
<span class="n">scheduler_default_weighers</span> <span class="o">=</span> <span class="n">GoodnessWeigher</span>
<span class="n">enabled_backends</span> <span class="o">=</span> <span class="n">lvm</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">lvm</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">lvm</span><span class="o">-</span><span class="mi">3</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">volume_group</span> <span class="o">=</span> <span class="n">stack</span><span class="o">-</span><span class="n">volumes</span><span class="o">-</span><span class="n">lvmdriver</span><span class="o">-</span><span class="mi">1</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">lvm</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">lvmdriver</span><span class="o">-</span><span class="mi">1</span>
<span class="n">filter_function</span> <span class="o">=</span> <span class="s">&quot;volume.size &lt; 5&quot;</span>
<span class="n">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(capabilities.total_volumes &lt; 3) ? 100 : 50&quot;</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">volume_group</span> <span class="o">=</span> <span class="n">stack</span><span class="o">-</span><span class="n">volumes</span><span class="o">-</span><span class="n">lvmdriver</span><span class="o">-</span><span class="mi">2</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">lvm</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">lvmdriver</span><span class="o">-</span><span class="mi">2</span>
<span class="n">filter_function</span> <span class="o">=</span> <span class="s">&quot;volumes.size &lt; 5&quot;</span>
<span class="n">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(capabilities.total_volumes &lt; 8) ? 100 : 50&quot;</span>

<span class="p">[</span><span class="n">lvm</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="n">volume_group</span> <span class="o">=</span> <span class="n">stack</span><span class="o">-</span><span class="n">volumes</span><span class="o">-</span><span class="n">lvmdriver</span><span class="o">-</span><span class="mi">3</span>
<span class="n">volume_driver</span> <span class="o">=</span> <span class="n">cinder</span><span class="o">.</span><span class="n">volume</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">LVMVolumeDriver</span>
<span class="n">volume_backend_name</span> <span class="o">=</span> <span class="n">lvmdriver</span><span class="o">-</span><span class="mi">3</span>
<span class="n">goodness_function</span> <span class="o">=</span> <span class="s">&quot;55&quot;</span>
</pre></div>
</div>
<p>The above is an example of how back-end specific properties can be used
in the filter and goodness functions. In this example the LVM driver&#8217;s
<tt class="docutils literal"><span class="pre">total_volumes</span></tt> capability is being used to determine which host gets
used during a volume request. In the above example, lvm-1 and lvm-2 will
handle volume requests for all volumes with a size less than 5&nbsp;GB. The
lvm-1 host will have priority until it contains three or more volumes.
After than lvm-2 will have priority until it contains eight or more
volumes. The lvm-3 will collect all volumes greater or equal to 5&nbsp;GB as
well as all volumes once lvm-1 and lvm-2 lose priority.</p>
</div>
</div>


              </div>
          </div>
          </div>
          <!-- <div class="docs-tags">
                <a href="#" class="docs-tag">Network Time Protocol (NTP)</a>
                <a href="#" class="docs-tag">Security</a>
                <a href="#" class="docs-tag">Conceptual architecture</a>
            </div> -->
<div class="docs-actions">
                  
                  <a href="blockstorage-consistency-groups.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Consistency groups"></i></a>
                  
                  
                  <a href="blockstorage_ratelimit_volume_copy_bandwidth.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Rate-limit volume copy bandwidth"></i></a>
                  
                  <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
                </div>
                <div class="row docs-byline bottom">
                <div class="docs-updated">
                updated: 2015-10-23 15:47 | release: 0.9
                </div>
                <a href="http://git.openstack.org/" class="docs-edit">
                    <i class="fa fa-pencil"></i> suggest edits
                </a>
</div>
    <div class="row">
         <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
           <img src="_static/images/docs/license.png" alt="Creative Commons Attribution 3.0 License"/>
<p>
 Except where otherwise noted, this document is licensed under Creative Commons
 Attribution 3.0 License
 <a href="#">http://creativecommons.org/licenses/by/3.0/legalcode</a>.
</p>
<p>
 <a href="http://www.openstack.org/legal">See All Legal Notices</a>
</p>
         </div>
         <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
                    <!-- ID buglinkbottom added so that pre-filled doc bugs
                    are sent to Launchpad projects related to the document -->
                    <a href="#" id="logABugLink2" class="docs-footer-actions">
                        <i class="fa fa-bug"></i>found an error? report a bug
                    </a>
                    <a href="http://ask.openstack.org" class="docs-footer-actions">
                        <i class="fa fa-question-circle"></i>questions? <a href="http://ask.openstack.org/">ask.openstack.org</a>
                    </a>
                </div>
     </div>
     </div>
            <!-- Docs Sidebar -->
                <div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
            <div class="search-icon show"><i class="fa fa-search"></i>
Search</div>
            <div class="btn-group docs-sidebar-releases">
                <button onclick="location.href='/'" class="btn docs-sidebar-home" data-toggle="tooltip" data-placement="top" title="Docs Home"><i class="fa fa-arrow-circle-o-left"></i></button>
                <button href="#" type="button" data-toggle="dropdown" class="btn docs-sidebar-release-select">Release: Kilo (April 2015)<i class="fa fa-caret-down"></i></button>
                <ul class="dropdown-menu docs-sidebar-dropdown" role="menu" aria-labelledby="dLabel">
                    <li role="presentation" class="dropdown-header">Releases</li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/kilo/">Kilo (current release)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/juno/">Juno (October 2014)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/icehouse/">Icehouse (May 2014)</a></li>
                    <li role="presentation" class="dropdown-header">Languages</li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/ja/">日本語 (Japanese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/de/">Deutsch (German)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/fr/">Français (French)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/pt_BR/">Português (Portuguese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/zh_CN/">简体中文 (Simplified Chinese)</a></li>
                    <li role="presentation"><a role="menuitem" tabindex="-1" href="/ko_KR/">한국어 (Korean)</a></li>
                </ul>
            </div>
                <div class="docs-sidebar-toc">
                    <div class="docs-sidebar-section" id="install-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#install-guides"><h4>Install Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="user-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#user-guides"><h4>User Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="configuration-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#configuration-guides"><h4>Configuration Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="operations-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/openstack-ops/content/"><h4>Operations Guide</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="api-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#api-guides"><h4>API Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="contributor-guides">
                        <a class="docs-sidebar-section-title" href="http://docs.openstack.org/index.html#contributor-guides"><h4>Contributor Guides</h4></a>
                    </div>
                    <div class="docs-sidebar-section" id="table-of-contents">
                        <a class="docs-sidebar-section-title"><h4>Contents</h4></a>
                        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="common/conventions.html">Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/get_started_with_openstack.html">Get started with OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="identity_management.html">Identity management</a></li>
<li class="toctree-l1"><a class="reference internal" href="dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="compute.html">Compute</a></li>
<li class="toctree-l1"><a class="reference internal" href="objectstorage.html">Object Storage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="blockstorage.html">Block Storage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="blockstorage-api-throughput.html">Increase Block Storage API service throughput</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="blockstorage-manage-volumes.html">Manage volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="blockstorage-troubleshoot.html">Troubleshoot your installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="shared_file_systems.html">Shared File Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="networking.html">Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="telemetry.html">Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="baremetal.html">Bare Metal</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html">Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_project.html">Cross-project features</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/app_support.html">Community support</a></li>
<li class="toctree-l1"><a class="reference internal" href="common/glossary.html">Glossary</a></li>
</ul>

                    </div>
                </div>
                </div>

</div>
</div>
    <!-- End Page Content -->

    <!-- Footer -->
    <!-- Footer -->
        <footer>
        <div class="container">
            <div class="row footer-links">
                <div class="col-lg-2 col-sm-2">
                    <h3>OpenStack</h3>
                    <ul>
                        <li><a href="/foundation">About the Foundation</a></li>
                        <li><a
href="http://openstack.org/projects/">Projects</a></li>
                        <li><a
href="http://openstack.org/projects/openstack-security/">OpenStack
Security</a></li>
                        <li><a
href="http://openstack.org/projects/openstack-faq/">Common Questions</a></li>
                        <li><a href="http://openstack.org/blog/">Blog</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Community</h3>
                    <ul>
                        <li><a href="http://openstack.org/community/">User
Groups</a></li>
                        <li><a
href="http://openstack.org/community/events/">Events</a></li>
                        <li><a
href="http://openstack.org/community/jobs/">Jobs</a></li>
                        <li><a
href="http://openstack.org/foundation/companies/">Companies</a></li>
                        <li><a
href="https://wiki.openstack.org/wiki/How_To_Contribute">Contribute</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Documentation</h3>
                    <ul>
                        <li><a href="http://docs.openstack.org">OpenStack
Manuals</a></li>
                        <li><a
href="http://openstack.org/software/start/">Getting Started</a></li>
                        <li><a href="http://developer.openstack.org">API
Documentation</a></li>
                        <li><a href="https://wiki.openstack.org">Wiki</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-sm-2">
                    <h3>Branding & Legal</h3>
                    <ul>
                        <li><a href="http://openstack.org/brand/">Logos &
Guidelines</a></li>
                        <li><a
href="http://openstack.org/brand/openstack-trademark-policy/">Trademark
Policy</a></li>
                        <li><a href="http://openstack.org/privacy/">Privacy
Policy</a></li>
                        <li><a
href="https://wiki.openstack.org/wiki/How_To_Contribute#Contributors_License_Agreement">OpenStack
CLA</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-sm-4">
                    <h3>Stay In Touch</h3>
                    <a href="https://twitter.com/OpenStack" target="_blank"
class="social-icons footer-twitter"></a>
                    <a href="https://www.facebook.com/openstack"
target="_blank" class="social-icons footer-facebook"></a>
                    <a href="https://www.linkedin.com/company/openstack"
target="_blank" class="social-icons footer-linkedin"></a>
                    <a href="https://www.youtube.com/user/OpenStackFoundation"
target="_blank" class="social-icons footer-youtube"></a>
                    <!-- <form class="form-inline">
                        <div class="form-group newsletter-form">
                            <label>Join Our Newsletter</label>
                            <input class="newsletter-input" type="input"
placeholder="Email">
                            <button type="submit"
class="newsletter-btn">Join</button>
                        </div>
                    </form> -->
                    <p class="fine-print">
                        The OpenStack project is provided under the Apache 2.0
license. Openstack.org is powered by <a href="http://rackspace.com"
target="_blank">Rackspace Cloud Computing</a>.
                    </p>
                </div>
            </div>
        </div>
    </footer>
    <div class="footer-bottom">
        <div class="container">
            <form class="form-inline" id="FeedbackForm_FeedbackForm" action="/home/FeedbackForm" method="post" enctype="application/x-www-form-urlencoded">
              <div class="form-group">
                <div>
                  <input class="feedback-input" type="input" placeholder="Give Us Your Feedback On This Page">
                  <button type="submit" class="feedback-btn">Submit</button>
                </div>
              </div>
            </form>
        </div>
    </div>

<!-- Scripts in: static directory-->
    <!-- jQuery Version 1.11.0 -->
    <script type="text/javascript" src="_static/js/jquery-1.11.3.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script type="text/javascript" src="_static/js/bootstrap.min.js"></script>

    <!-- The rest of the JS -->
    <script type="text/javascript" src="_static/js/navigation.js"></script>

    <!-- Docs JS -->
    <script type="text/javascript" src="_static/js/docs.js"></script>

    <!-- Popovers -->
    <script type="text/javascript" src="_static/js/webui-popover.js"></script>

    <!-- Javascript for page -->
    <script language="JavaScript">
    /* build a description of this page including SHA, source location on git repo and
       build time, the project's launchpad bug tag and set the HREF of the bug buttons */

        var lineFeed = "%0A";

        /* gitsha, project and bug_tag rely on variables in conf.py */
        var gitSha = "SHA: f7a37b8ab67b5fbe8597432774a12df3186c2e65"
        var bugTitle = "Configure and use driver filter and weighing for scheduler in Cloud Administrator Guide"
        var fieldTags = "admin-guide-cloud"

        /* "last_updated" is the build date and time. It relies on the
           conf.py variable "html_last_updated_fmt", which should include
           year/month/day as well as hours and minutes                   */
        var buildstring = "Release: 0.9 on 2015-10-23 15:47"

        var fieldComment = encodeURI(buildstring) +
                           lineFeed + encodeURI(gitSha) +
                           lineFeed + encodeURI(gitlink)

        logABug(bugTitle, fieldComment, fieldTags)
    </script>
    <!-- Javascript for search boxes (both sidebar and top nav) -->
<script type="text/javascript">
        (function() {
        var cx = '000108871792296872333:noj9nikm74i';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' :
'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
       </script>

 </body>
</html>